# ============================================================
# AresBot v3 环境变量配置
# 复制此文件为 .env 并填入实际值
# ============================================================


# ############################################################
#                        主节点配置
#            使用 docker-compose.yml 部署时需要配置
# ############################################################

# -------------------- 安全密钥 (必填) --------------------
# API 密钥加密用，所有节点必须使用相同的密钥
# 生成命令: openssl rand -hex 32
ENCRYPTION_KEY=

# Nginx -> API 内部鉴权密钥（防止伪造 X-Forwarded-Email）
# 生成命令: openssl rand -hex 32
API_INTERNAL_AUTH=

# -------------------- MySQL 配置 (必填) --------------------
# 数据库 root 密码
MYSQL_ROOT_PASSWORD=
# 应用使用的数据库名
MYSQL_DATABASE=aresbot
# 应用使用的数据库用户名
MYSQL_USER=aresbot
# 应用使用的数据库密码 (支持特殊字符，无需手动编码)
MYSQL_PASSWORD=

# MySQL 容器时区（推荐 Asia/Shanghai，和北京时间一致）
MYSQL_TZ=Asia/Shanghai
# MySQL 会话默认时区（建议 +08:00，避免依赖时区表）
MYSQL_DEFAULT_TIME_ZONE=+08:00

# -------------------- Redis 配置 (必填) --------------------
# Redis 访问密码
REDIS_PASSWORD=

# Redis 网络超时（秒），跨节点部署建议保持较小值避免阻塞交易循环
REDIS_CONNECT_TIMEOUT=1.0
REDIS_SOCKET_TIMEOUT=1.0

# -------------------- OAuth2 Proxy 配置 (必填) --------------------
# GitHub OAuth App 配置
# 创建地址: https://github.com/settings/developers -> OAuth Apps -> New OAuth App
# Homepage URL: https://your-domain.com
# Authorization callback URL: https://your-domain.com/oauth2/callback
OAUTH2_PROXY_CLIENT_ID=
OAUTH2_PROXY_CLIENT_SECRET=

# Cookie 加密密钥 (必须是 16/24/32 字节的 base64 编码)
# 生成命令: openssl rand -base64 32 | head -c 32
OAUTH2_PROXY_COOKIE_SECRET=

# 域名配置
# 你的域名，如 ares.example.com
OAUTH2_PROXY_DOMAIN=ares.example.com
# Cookie 域名，如 .example.com (注意前面的点)
OAUTH2_PROXY_COOKIE_DOMAIN=.example.com

# -------------------- 服务端口 (可选) --------------------
# API 服务本机回环端口，默认 48000（仅 127.0.0.1 监听）
API_PORT=48000
# OAuth2 Proxy 本机回环端口，默认 44180（仅 127.0.0.1 监听）
OAUTH2_PROXY_PORT=44180
# MySQL 对外端口，默认 43306 (工作节点需要访问此端口)
MYSQL_PORT=43306
# Redis 对外端口，默认 46379 (工作节点需要访问此端口)
REDIS_PORT=46379

# -------------------- Worker 配置 (可选) --------------------
# 主节点上运行的 Worker 副本数，默认 2
WORKER_REPLICAS=2
# 每个 Worker 的并发数 (同时运行的策略数)，默认 4
CELERY_CONCURRENCY=4
# Worker 执行池类型: threads (共享WebSocket连接) 或 prefork (进程隔离)
# 使用 threads 可让同一账户的多个策略共享 WebSocket 连接，减少连接数
CELERY_POOL=threads
# 日志级别: debug, info, warning, error
CELERY_LOG_LEVEL=info

# 停止信号兜底轮询间隔（秒），主路径通过 Redis Pub/Sub 立即通知
STRATEGY_STOP_POLL_INTERVAL=0.8

# Worker 网络身份识别超时（秒）和缓存时间（秒）
WORKER_NETWORK_HTTP_TIMEOUT=2.0
WORKER_NETWORK_CACHE_SECONDS=300

# 可选：手动覆盖 Worker 的出口 IP / 内网 IP / 归属地
# 适用于 Worker 无法访问公网 IP 查询服务，或希望固定展示标签
WORKER_PUBLIC_IP=
WORKER_PRIVATE_IP=
WORKER_IP_LOCATION=


# ############################################################
#                        工作节点配置
#          使用 docker-compose.worker.yml 部署时需要配置
#              (除了上面的通用配置外，还需要以下配置)
# ############################################################

# -------------------- 主节点连接 (工作节点必填) --------------------
# 主节点 IP 地址或域名
MASTER_HOST=
# 主节点 MySQL 端口 (与主节点的 MYSQL_PORT 一致)
MASTER_MYSQL_PORT=43306
# 主节点 Redis 端口 (与主节点的 REDIS_PORT 一致)
MASTER_REDIS_PORT=46379


# ############################################################
#                        配置说明
# ############################################################
#
# 【GitHub OAuth App 创建步骤】
#   1. 访问 https://github.com/settings/developers
#   2. 点击 "OAuth Apps" -> "New OAuth App"
#   3. 填写信息:
#      - Application name: AresBot (随意)
#      - Homepage URL: https://your-domain.com
#      - Authorization callback URL: https://your-domain.com/oauth2/callback
#   4. 创建后获取 Client ID 和 Client Secret
#
# 【邮箱白名单配置】
#   编辑 oauth2-proxy/authenticated-emails.txt 文件
#   每行一个允许登录的邮箱地址
#
# 【主节点部署】
#   1. 复制此文件为 .env
#   2. 填写"主节点配置"部分的所有必填项
#   3. 配置 oauth2-proxy/authenticated-emails.txt 邮箱白名单
#   4. 运行: docker compose up -d --build
#
# 【工作节点部署】
#   1. 复制此文件为 .env
#   2. 填写"主节点配置"中的通用配置 (ENCRYPTION_KEY, MYSQL_*, REDIS_PASSWORD)
#   3. 填写"工作节点配置"部分 (MASTER_HOST 等)
#   4. 运行: docker compose -f docker-compose.worker.yml up -d --build
#
# 【注意事项】
#   - ENCRYPTION_KEY 必须所有节点一致，否则无法解密 API 密钥
#   - 工作节点需要能访问主节点的 MySQL 和 Redis 端口
#   - 确保防火墙放行相应端口
#
